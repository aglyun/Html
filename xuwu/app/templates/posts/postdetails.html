{% extends 'base.html' %}

{% block postdetails %}

    <span class="badge badge-warning">作者：{{ post.user.username }}</span>
    <span class="badge badge-primary">{{ post.create_time }}</span>
    <br>
    <span class="badge badge-danger">点赞</span>
    <span class="badge badge-success">收藏</span>
    <span class="badge badge-info">分享</span>
    <span class="badge badge-light">+</span>
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-brush-fill" viewBox="0 0 16 16">
  <path d="M15.825.12a.5.5 0 0 1 .132.584c-1.53 3.43-4.743 8.17-7.095 10.64a6.067 6.067 0 0 1-2.373 1.534c-.018.227-.06.538-.16.868-.201.659-.667 1.479-1.708 1.74a8.118 8.118 0 0 1-3.078.132 3.659 3.659 0 0 1-.562-.135 1.382 1.382 0 0 1-.466-.247.714.714 0 0 1-.204-.288.622.622 0 0 1 .004-.443c.095-.245.316-.38.461-.452.394-.197.625-.453.867-.826.095-.144.184-.297.287-.472l.117-.198c.151-.255.326-.54.546-.848.528-.739 1.201-.925 1.746-.896.126.007.243.025.348.048.062-.172.142-.38.238-.608.261-.619.658-1.419 1.187-2.069 2.176-2.67 6.18-6.206 9.117-8.104a.5.5 0 0 1 .596.04z"/>
</svg>
    <br>
    <br>
    <div class="col-sm-pull-6 shadow p-3 mb-5 bg-white rounded ">
            <h4>{{ post.title }}</h4>
            <hr>
            <div style="color: #6cbfee; margin: 2px">
                {{ post.content|safe}}
                <div style="text-align: center; padding: 10px; color: rgba(0,0,0,0.03)">------ 梦究竟是个什么样子的空间------</div>
            </div>
        <hr>
        <div style="text-align: center">
        <button class="btn btn-primary" type="button" disabled id="pl">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-fill" viewBox="0 0 16 16"><path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"/> </svg>
            评论
        </button>
            {% if um %}
        <button class="btn btn-danger" type="button" id="jh">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16"><path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"/></svg>
            删除
        </button>
            {% endif %}
        </div>
        </div>



        {% if um %}
        <!-- 输入框，可随时发送更新,只有登录了才能操作 -->
        <div class="input-group" style="padding-bottom: 5px">
            <textarea class="form-control" aria-label="With textarea" style="height: 40px" placeholder="你想说些什么" name="comment" id="comment"></textarea>
            <button id="CommentButton" type="button" class="btn btn-primary" style="border-radius: 0 5px 5px 0;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-send-fill" viewBox="0 0 16 16"><path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z"/></svg>
            </button>
        </div>
        {% else %}
            <h6>登录后才能评论</h6>
        {% endif %}
     <!--显示评论-->
    <hr>
    <h5><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-chat-square-text-fill" viewBox="0 0 16 16"><path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.5a1 1 0 0 0-.8.4l-1.9 2.533a1 1 0 0 1-1.6 0L5.3 12.4a1 1 0 0 0-.8-.4H2a2 2 0 0 1-2-2V2zm3.5 1a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1h-9zm0 2.5a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1h-9zm0 2.5a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5z"/> </svg>  评论</h5>
    {% for i in comments %}
    <div class="media border p-3" style="background-color: white">
      <img decoding="async" src="https://tse1-mm.cn.bing.net/th/id/OIP-C.2TXelD9K5kU6X65jk-Jg9gAAAA?w=207&h=207&c=7&r=0&o=5&dpr=1.3&pid=1.7" alt="John Doe" class="mr-3 mt-3 rounded-circle" style="width:60px;">
      <div class="media-body">
        <h4>{{ i.user.username }}</h4>
          {% if i.content|length < 6 %}
              <p>
              <a data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
                点击展开
              </a>
            </p>
            <div class="collapse" id="collapseExample">
              <div class="card card-body">
                  <p>{{ i.content }}</p>
                  <span style="color:rgb(158,158,158);">{{ i.create_time }}</span>
                  {% if um %}
                      {% if  post.user.id == um.id or i.user.id == um.id %}
                          <a href="{{ url_for('post.comment_delete', user_id=um.id, comment_id=i.id, post_id=post.id) }}" style="color: red; padding-top: 10px; display: inline">删除</a>
                      {% endif %}
                  {% endif %}
              </div>
            </div>

          {% else %}
              <div class="card card-body">
                  <p>{{ i.content }}</p>
                  <span style="color:rgb(158,158,158);">{{ i.create_time }}</span>
                  {% if um %}
                      {% if  post.user.id == um.id or i.user.id == um.id%}
                          <a href="{{ url_for('post.comment_delete', user_id=um.id, comment_id=i.id, post_id=post.id) }}" style="color: red; padding-top: 10px; display: inline">删除</a>
                      {% endif %}
                  {% endif %}
              </div>
          {% endif %}
      </div>
    </div>
    {% endfor %}
    {% if um %}
    <script>
        $(document).ready(function (){
            $('#pl').removeAttr('disabled');  // 加载完成移除禁用
        })

        $(function (){
            $("#CommentButton").click(function (){
                // 获取框中内容
                var t = $("#comment").val()
                // 异步请求
                $.ajax({
                    url: '/post/write/comment/{{ um.id }}/{{ post.id }}',
                    type: 'post',
                    data: {'comment': t},
                    success: function (data) {
                        location.reload(true);

                    }
                })

            })
        })
    </script>
    {% endif %}
{% endblock %}